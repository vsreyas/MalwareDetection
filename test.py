import numpy as np
import pcaper
import os
import pandas as pd

def test_preprocess(file_path, features):
    current = os.getcwd()
    pcap_parser = pcaper.PcapParser()
    params = {
        'input': file_path,
    }
    i = 0
    for request in pcap_parser.read_pcap(params):
            dest = os.path.join(current,'http'+str(i)+'.txt')
            f1 = open(dest,'w')
            request_list = request.split("\n")
            for each in request_list:
                curr = each
                rep = [',',';',':','/','?','=','(',')','{','}','the','is','were','  ']
                for r in rep:
                    curr = curr.replace(r,' ')
                common = ['.jpg','.png','.gif','.js','.css']
                new = curr.split()
                for check in common:
                    for word in new:
                        k = word.find(check)
                        if k >= 0: new.remove(word)
                new.append('\n')
                new = ' '.join(new)
                f1.write(new)
            f1.close()
            i = i + 1

    f = open(dest, 'r')
    l = len(features)
    v = np.zeros((l,1), dtype=np.uint8)

    for line in f:
        for i in range(l):
            word = features[i]
            k = line.find(word)
            if k >= 0: v[i] = 1

    return v

