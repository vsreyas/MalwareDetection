import os
import  pandas as pd
import numpy as np
import pcaper
import transform, featuresel, createdataset , exp

#Input main_dir as directory of pcap files
#Input path of catalog
#Choose value of K
main_dir = '/home/venky/Documents/IITM Dec/Malware detection using N Grams and SVM/MalDetHTTP/data_p'
catalog = '/home/venky/Documents/IITM Dec/Malware detection using N Grams and SVM/MalDetHTTP/Processed Labels.csv'
k = 8
directory = "/home/venky/Documents/IITM Dec/Malware detection using N Grams and SVM/MalDetHTTP/trial"

dir_http_txt = os.path.join(directory,"http_txt")
dir_http_csv = os.path.join(directory,"http_cv")
os.mkdir(dir_http_txt)
os.mkdir(dir_http_csv)



createdataset.createDataset(main_dir=main_dir, directory=dir_http_txt, dcsv=dir_http_csv, catalog_dir=catalog,y = 1) 
path_exp_m, path_exp_nm = exp.calcFeatures(dir_http_csv)
features  = featuresel.featureSelection(k,path_exp_m,path_exp_nm)
x, y = transform.transform(dir_http_txt,features)

from sklearn.model_selection import train_test_split
x_train, x_test, y_train, y_test = train_test_split( x, y, test_size=0.33, random_state=42)


from sklearn.pipeline import make_pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.svm import SVC
clf = make_pipeline(StandardScaler(), SVC(gamma='auto'))
clf.fit(x_train, y_train)

y_hat = clf.predict(x_test)

from sklearn.metrics import accuracy_score
score = accuracy_score(y_test,y_hat)



