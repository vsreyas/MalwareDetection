import os
import pandas as pd
import numpy as np

def featureSelection(k,path_exp_m, path_exp_nm):

    df_exp_nm = pd.read_csv(path_exp_nm, names=['Word','Frequency'])
    df_exp_m = pd.read_csv(path_exp_m, names=['Word','Frequency'])
    
    exp_m = df_exp_m.to_numpy()
    chi_square = np.copy(exp_m)
    arg = np.zeros(exp_m.shape[0])

    for i in range(2,exp_m.shape[0]):
        word = exp_m[i][0] 
        expected = float(df_exp_nm.loc[lambda df: df['Word'] == word, 'Frequency'])
        if expected == 0:
            continue
        chi_sq = (float(exp_m[i][1])-expected)**2
        chi_sq = chi_sq/expected
        chi_square[i][1] = chi_sq
        arg[i] = chi_sq

    ind = np.argsort(arg)
    features = []
    for i in range(k):
        features.append(str(chi_square[ind[exp_m.shape[0]-1-i]][0]))

    features = np.array(features)
    features.tofile('features.csv', sep = ',')
    return features

'''featureSelection(8,"/home/venky/Documents/IITM Dec/Malware detection using N Grams and SVM/MalDetHTTP/data_p/csv/Exp_m_reduced.csv","data_p/csv/Exp_nm_reduced.csv")'''